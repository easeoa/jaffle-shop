models:
  - name: order_items
    description: 注文アイテム概要データマート。各注文アイテムの詳細情報と収益分析を提供します。注文アイテム1つにつき1行です。
    columns:
      - name: order_item_id
        description: 注文アイテムのユニークキー
        data_tests:
          - not_null
          - unique
      - name: order_id
        description: 注文を参照する外部キー
        data_tests:
          - relationships:
              to: ref('orders')
              field: order_id
      - name: product_id
        description: 製品を参照する外部キー
      - name: ordered_at
        description: 注文が行われたタイムスタンプ
      - name: product_name
        description: 製品名
      - name: product_price
        description: 製品価格
      - name: is_food_item
        description: 食品アイテムかどうかを示すブール値
      - name: is_drink_item
        description: ドリンクアイテムかどうかを示すブール値
      - name: supply_cost
        description: 供給コスト
    meta:
      metrics:
        order_item_count:
          label: 注文アイテム数
          type: count_distinct
          sql: ${TABLE}.order_item_id
        revenue:
          label: 収益
          type: sum
          sql: ${TABLE}.product_price
        order_cost:
          label: 注文コスト
          type: sum
          sql: ${TABLE}.supply_cost
        food_revenue:
          label: 食品収益
          type: sum
          sql: case when ${TABLE}.is_food_item then ${TABLE}.product_price else 0 end
        drink_revenue:
          label: ドリンク収益
          type: sum
          sql: case when ${TABLE}.is_drink_item then ${TABLE}.product_price else 0 end
        median_revenue:
          label: 収益中央値
          type: median
          sql: ${TABLE}.product_price
        food_revenue_pct:
          label: 食品収益比率
          type: number
          sql: case when ${TABLE}.is_food_item then ${TABLE}.product_price else 0 end / nullif(${TABLE}.product_price, 0) * 100
        drink_revenue_pct:
          label: ドリンク収益比率
          type: number
          sql: case when ${TABLE}.is_drink_item then ${TABLE}.product_price else 0 end / nullif(${TABLE}.product_price, 0) * 100
        order_gross_profit:
          label: 注文粗利益
          type: number
          sql: ${TABLE}.product_price - ${TABLE}.supply_cost


